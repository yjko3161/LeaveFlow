<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlexLite ERP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f3f4f6;
        }

        .sidebar-item-active {
            background-color: #e5e7eb;
            color: #111827;
            font-weight: 500;
        }
    </style>
</head>

<body class="h-screen flex overflow-hidden">

    <!-- Sidebar -->
    {% if current_user.is_authenticated %}
    <aside class="w-64 bg-white border-r border-gray-200 flex-shrink-0 flex flex-col print:hidden">
        <div class="h-16 flex items-center px-6 border-b border-gray-100">
            <span class="text-xl font-bold tracking-tight text-indigo-600">FlexLite</span>
        </div>

        <nav class="flex-1 px-3 py-4 space-y-1 overflow-y-auto">
            <a href="{{ url_for('main.dashboard') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if request.endpoint == 'main.dashboard' }}">
                <span class="flex-1">대시보드</span>
            </a>

            <div class="pt-4 pb-2">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">업무</p>
            </div>

            <a href="{{ url_for('leave.index') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'leave' in request.endpoint }}">
                <span class="flex-1">내 연차</span>
            </a>
            <a href="{{ url_for('expense.index') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'expense' in request.endpoint }}">
                <span class="flex-1">지출결의</span>
            </a>
            <a href="{{ url_for('certificate.list') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'certificate' in request.endpoint }}">
                <span class="flex-1">증명서 발급</span>
            </a>
            <a href="{{ url_for('quote.index') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'quote' in request.endpoint }}">
                <span class="flex-1">견적서 관리</span>
            </a>

            <div class="pt-4 pb-2">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">결재</p>
            </div>
            {% if current_user.role in ['ADMIN', 'MANAGER'] %}
            <a href="{{ url_for('approval.inbox') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'approval' in request.endpoint }}">
                <span class="flex-1">결재함</span>
                <!-- Badge -->
                <!-- <span class="bg-red-100 text-red-600 py-0.5 px-2 rounded-full text-xs">2</span> -->
            </a>
            {% endif %}

            <div class="pt-4 pb-2">
                <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">관리</p>
            </div>
            {% if current_user.role in ['ADMIN', 'MANAGER'] %}
            <a href="{{ url_for('leave.manage') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'leave.manage' == request.endpoint }}">
                <span class="flex-1">직원 연차 관리</span>
            </a>
            {% endif %}

            {% if current_user.role == 'ADMIN' %}
            <a href="{{ url_for('settings.company') }}"
                class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-50 hover:text-gray-900 {{ 'sidebar-item-active' if 'settings.company' == request.endpoint }}">
                <span class="flex-1">회사 정보 설정</span>
            </a>
            {% endif %}

        </nav>

        <div class="p-4 border-t border-gray-200">
            <div class="flex items-center">
                <div class="ml-3">
                    <a href="{{ url_for('settings.index') }}"
                        class="text-sm font-medium text-gray-700 hover:text-indigo-600 hover:underline">
                        {{ current_user.name }}
                    </a>
                    <div class="mt-1">
                        <a href="{{ url_for('auth.logout') }}"
                            class="text-xs font-medium text-gray-500 hover:text-gray-700">로그아웃</a>
                    </div>
                </div>
            </div>
        </div>
    </aside>
    {% endif %}

    <!-- Main Content -->
    <main class="flex-1 flex flex-col overflow-hidden bg-gray-50 print:bg-white print:overflow-visible">
        <!-- Topbar -->
        {% if current_user.is_authenticated %}
        <header class="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-6 print:hidden">
            <h1 class="text-lg font-semibold text-gray-900">
                {% block header_title %}Dashboard{% endblock %}
            </h1>
            <div class="flex items-center space-x-4">
                <a href="{{ url_for('approval.inbox') }}"
                    class="p-1 rounded-full text-gray-400 hover:text-gray-500 relative">
                    <span class="sr-only">알림</span>
                    <!-- Bell Icon -->
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                    </svg>
                    {% if unread_count > 0 %}
                    <span
                        class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 transform translate-x-1/4 -translate-y-1/4 bg-red-600 rounded-full">{{
                        unread_count }}</span>
                    {% endif %}
                </a>
            </div>
        </header>
        {% endif %}

        <!-- Scrollable Content -->
        <div class="flex-1 overflow-auto p-6 print:p-0 print:overflow-visible print:h-auto">
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
            <div class="mb-6 space-y-2 print:hidden">
                {% for category, message in messages %}
                <div
                    class="p-4 rounded-md {{ 'bg-green-50 text-green-700' if category == 'success' else 'bg-red-50 text-red-700' }}">
                    {{ message }}
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>
    </main>

</body>

</html>